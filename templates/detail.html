<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- [SEO] -->
    <title>{{ meta_title }}</title>
    <meta name="description" content="{{ meta_desc }}">
    <link rel="canonical" href="{{ meta_url }}">
    
    <!-- [SEO] Open Graph -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="{{ meta_url }}">
    <meta property="og:title" content="{{ meta_title }}">
    <meta property="og:description" content="{{ meta_desc }}">
    
    <!-- [SEO] JSON-LD -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "EducationalOrganization",
      "name": "{{ school.basic_info.name_ja }}",
      "address": "{{ school.basic_info.address }}",
      "geo": {
        "@type": "GeoCoordinates",
        "latitude": {{ school.location.lat }},
        "longitude": {{ school.location.lng }}
      }
    }
    </script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EDJL0618LL"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-EDJL0618LL');
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.6; color: #333; }
        h1 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        .lang-switch { text-align: right; margin-bottom: 20px; }
        .lang-btn { background: none; border: 1px solid #ddd; padding: 5px 10px; cursor: pointer; border-radius: 4px; }
        
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .box { background: #f8f9fa; padding: 20px; border-radius: 8px; }
        .label { font-weight: bold; color: #7f8c8d; display: block; margin-bottom: 5px; }
        .value { font-size: 1.2rem; font-weight: bold; }
        .back-btn { display: inline-block; margin-bottom: 20px; text-decoration: none; color: #3498db; font-weight: bold; }
        #map { width: 100%; height: 300px; border-radius: 8px; margin-top: 20px; }
        
        .cta-btn { 
            display: inline-block; background: #3498db; color: white; padding: 15px 30px; 
            text-decoration: none; border-radius: 5px; font-weight: bold; margin-top: 30px; 
        }
        @media (max-width: 600px) { .info-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <div class="lang-switch">
        <button class="lang-btn" onclick="setLanguage('ko')">ğŸ‡°ğŸ‡·</button>
        <button class="lang-btn" onclick="setLanguage('ja')">ğŸ‡¯ğŸ‡µ</button>
        <button class="lang-btn" onclick="setLanguage('en')">ğŸ‡ºğŸ‡¸</button>
    </div>

    <a href="/" class="back-btn" data-i18n="btn_back">â† ì§€ë„ ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>

    <article>
        <h1>{{ school.basic_info.name_ja }}</h1>
        <p>ğŸ“ {{ school.basic_info.address }}</p>

        <div class="info-grid">
            <div class="box">
                <span class="label" data-i18n="lbl_capacity">ì´ ì •ì›</span>
                <span class="value">{{ school.basic_info.capacity }}<span data-i18n="unit_ppl">ëª…</span></span>
            </div>
            <div class="box">
                <span class="label" data-i18n="lbl_total">ì´ í•™ìƒìˆ˜</span>
                <span class="value">{{ school.student_demographics.total }}<span data-i18n="unit_ppl">ëª…</span></span>
            </div>
            <div class="box">
                <span class="label" data-i18n="lbl_korea">í•œêµ­ì¸ ë¹„ìœ¨</span>
                {% if school.student_demographics.total > 0 %}
                    <span class="value" style="color:#27ae60">{{ "%.1f"|format(school.student_demographics.korea / school.student_demographics.total * 100) }}%</span>
                {% else %}
                    <span class="value">0%</span>
                {% endif %}
            </div>
            <div class="box">
                <span class="label" data-i18n="lbl_fee">ëŒ€í‘œ í•™ë¹„ (ì²«í•´)</span>
                {% if school.courses and school.courses|length > 0 %}
                    <span class="value" style="color:#e74c3c">{{ "{:,}".format(school.courses[0].total_fees) }}Â¥</span>
                {% else %}
                    <span class="value">-</span>
                {% endif %}
            </div>
        </div>

        <h2 data-i18n="ttl_features">ğŸ« í•™êµ íŠ¹ì§•</h2>
        <ul>
            {% if school.features %}
                {% for feature in school.features %}
                <li>{{ feature }}</li>
                {% endfor %}
            {% else %}
                <li data-i18n="txt_no_data">ë°ì´í„° ì—†ìŒ</li>
            {% endif %}
        </ul>

        <h2 data-i18n="ttl_career">ğŸ“Š ì§„í•™ ì‹¤ì </h2>
        <ul>
            {% if school.career_path %}
                <li><span data-i18n="lbl_grad">ëŒ€í•™ì›</span>: {{ school.career_path.grad_school }}</li>
                <li><span data-i18n="lbl_univ">ëŒ€í•™</span>: {{ school.career_path.university }}</li>
                <li><span data-i18n="lbl_voc">ì „ë¬¸í•™êµ</span>: {{ school.career_path.vocational }}</li>
            {% endif %}
        </ul>

        <h2 data-i18n="ttl_loc">ğŸ—ºï¸ ìœ„ì¹˜</h2>
        <div id="map"></div>
        
        <div style="text-align: center;">
            <a href="{{ school.source_url }}" target="_blank" class="cta-btn" data-i18n="btn_official">
                ê³µì‹ ìƒì„¸ ì •ë³´ í™•ì¸í•˜ê¸°
            </a>
        </div>
    </article>

    <script>
        const translations = {
            ko: {
                btn_back: "â† ì§€ë„ ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°",
                lbl_capacity: "ì´ ì •ì›", lbl_total: "ì´ í•™ìƒìˆ˜", lbl_korea: "í•œêµ­ì¸ ë¹„ìœ¨", lbl_fee: "ëŒ€í‘œ í•™ë¹„ (ì²«í•´)",
                unit_ppl: "ëª…",
                ttl_features: "ğŸ« í•™êµ íŠ¹ì§•", txt_no_data: "ë“±ë¡ëœ íŠ¹ì§•ì´ ì—†ìŠµë‹ˆë‹¤.",
                ttl_career: "ğŸ“Š ì§„í•™ ì‹¤ì  (2023)", lbl_grad: "ëŒ€í•™ì› ì§„í•™", lbl_univ: "ëŒ€í•™ ì§„í•™", lbl_voc: "ì „ë¬¸í•™êµ ì§„í•™",
                ttl_loc: "ğŸ—ºï¸ ìœ„ì¹˜", btn_official: "ê³µì‹ ìƒì„¸ ì •ë³´ í™•ì¸í•˜ê¸° (ì¼ì§„í˜‘)"
            },
            ja: {
                btn_back: "â† ãƒãƒƒãƒ—ã«æˆ»ã‚‹",
                lbl_capacity: "å®šå“¡", lbl_total: "åœ¨ç±å­¦ç”Ÿæ•°", lbl_korea: "éŸ“å›½äººæ¯”ç‡", lbl_fee: "åˆå¹´åº¦ç´ä»˜é‡‘",
                unit_ppl: "å",
                ttl_features: "ğŸ« å­¦æ ¡ã®ç‰¹å¾´", txt_no_data: "ãƒ‡ãƒ¼ã‚¿ãªã—",
                ttl_career: "ğŸ“Š é€²å­¦å®Ÿç¸¾", lbl_grad: "å¤§å­¦é™¢", lbl_univ: "å¤§å­¦", lbl_voc: "å°‚é–€å­¦æ ¡",
                ttl_loc: "ğŸ—ºï¸ ã‚¢ã‚¯ã‚»ã‚¹", btn_official: "å…¬å¼æƒ…å ±ã‚’è¦‹ã‚‹ (æ—¥æŒ¯å”)"
            },
            en: {
                btn_back: "â† Back to Map",
                lbl_capacity: "Capacity", lbl_total: "Total Students", lbl_korea: "Korean Ratio", lbl_fee: "Tuition (1st Year)",
                unit_ppl: "",
                ttl_features: "ğŸ« Features", txt_no_data: "No data available",
                ttl_career: "ğŸ“Š Career Path", lbl_grad: "Grad School", lbl_univ: "University", lbl_voc: "Vocational",
                ttl_loc: "ğŸ—ºï¸ Location", btn_official: "View Official Details"
            }
        };

        function setLanguage(lang) {
            localStorage.setItem('lang', lang);
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    el.innerText = translations[lang][key];
                }
            });
        }

        // ì´ˆê¸° ì–¸ì–´ ë¡œë“œ
        setLanguage(localStorage.getItem('lang') || 'ko');

        // ì§€ë„ ë¡œë“œ (ê¸°ì¡´ê³¼ ë™ì¼)
        (g=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement("script"));e.set("libraries",[...r]+"");for(k in g)e.set(k.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase()),g[k]);e.set("callback",c+".maps."+q);a.src=`https://maps.${c}apis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})({
            key: "{{ maps_api_key }}",
            v: "weekly",
        });

        async function initMap() {
            const { Map } = await google.maps.importLibrary("maps");
            const { AdvancedMarkerElement } = await google.maps.importLibrary("marker");
            
            {% if school.location and school.location.lat %}
                const map = new Map(document.getElementById("map"), {
                    center: { lat: {{ school.location.lat }}, lng: {{ school.location.lng }} },
                    zoom: 15,
                    mapId: "DEMO_MAP_ID"
                });
                new AdvancedMarkerElement({
                    map: map,
                    position: { lat: {{ school.location.lat }}, lng: {{ school.location.lng }} },
                    title: "{{ school.basic_info.name_ja }}"
                });
            {% endif %}
        }
        initMap();
    </script>
</body>
</html>