{% extends "base.html" %}

{# --- 메인 콘텐츠 시작 --- #}
{% block content %}

<!-- 1. 지도 섹션 -->
<section class="map-section">
    <div id="map"></div>
</section>

<!-- 2. 카드 콘텐츠 섹션 -->
<div class="content-wrapper">

    <!-- [신규] Featured Collections (최상단 배치) -->
    <div class="section-header" style="margin-bottom: 20px;">
        <h2 class="section-title" style="color: var(--accent); display: flex; align-items: center; gap: 10px;">
            <i class="fa-solid fa-star"></i> Featured Collections
        </h2>
    </div>
    <div class="card-grid" style="margin-bottom: 80px;">
        {% for guide in featured_guides %}
        <a href="{{ guide.link }}" class="card" style="border: 2px solid var(--accent);">
            <div class="card-img" style="background-image: url('{{ guide.thumbnail }}'); height: 200px;">
                <span class="card-badge" style="background: var(--accent); color: white;">Best Selection</span>
            </div>
            <div class="card-body">
                <h4 style="font-size: 1.2rem; margin-bottom: 10px;">{{ guide.title }}</h4>
                <p style="font-size: 0.9rem; color: var(--text-gray);">{{ guide.description }}</p>
            </div>
            <div class="card-footer" style="background: #fff7ed;">
                <span style="color: var(--accent); font-weight: 700; font-size: 0.9rem;">View Ranking →</span>
            </div>
        </a>
        {% endfor %}
    </div>

    <!-- Language Schools -->
    <div class="section-header">
        <h2 class="section-title">Language Schools</h2>
        <a href="/schools" class="view-all">View all schools →</a>
    </div>
    <div class="card-grid">
        {% set school_imgs = [
            'https://images.unsplash.com/photo-1544531586-fde5298cdd40?w=500', 
            'https://images.unsplash.com/photo-1580582932707-520aed937b7b?w=500', 
            'https://images.unsplash.com/photo-1523240795612-9a054b0db644?w=500',
            'https://images.unsplash.com/photo-1491841550275-ad7854e35ca6?w=500',
            'https://images.unsplash.com/photo-1577985051167-0d49eec21977?w=500'
        ] %}
        {% for item in latest_schools %}
        <a href="{{ item.link }}" class="card">
            <div class="card-img" style="background-image: url('{{ school_imgs[loop.index0 % school_imgs|length] }}');">
                <span class="card-badge" style="color: var(--primary);">School</span>
            </div>
            <div class="card-body">
                <h4>{{ item.basic_info.name_en or item.basic_info.name_ja }}</h4>
                <div class="card-meta">
                    <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/></svg>
                    <span>{{ item.basic_info.address.split(' ')[0] if item.basic_info.address else 'Japan' }}</span>
                </div>
            </div>
            <div class="card-footer">
                <span class="card-price">
                    {% if item.get('tuition') and item.get('tuition').get('yearly_tuition') %}
                        ¥{{ "{:,}".format(item.get('tuition').get('yearly_tuition')) }}
                    {% else %}
                        Contact for Fee
                    {% endif %}
                </span>
                <span style="font-size: 0.75rem; color: var(--text-gray); font-weight: 600;">Yearly</span>
            </div>
        </a>
        {% endfor %}
    </div>

    <!-- Universities -->
    <div class="section-header" style="margin-top: 80px;">
        <h2 class="section-title">Top Universities</h2>
        <a href="/universities" class="view-all">View all universities →</a>
    </div>
    <div class="card-grid">
        {% set univ_imgs = [
            'https://images.unsplash.com/photo-1562774053-701939374585?w=500',
            'https://images.unsplash.com/photo-1498243691581-b145c3f54a5a?w=500',
            'https://images.unsplash.com/photo-1592280771190-3e2e4d571952?w=500',
            'https://images.unsplash.com/photo-1541339907198-e08756dedf3f?w=500',
            'https://images.unsplash.com/photo-1522202176988-66273c2fd55f?w=500'
        ] %}
        {% for item in latest_universities %}
        <a href="{{ item.link }}" class="card">
            <div class="card-img" style="background-image: url('{{ univ_imgs[loop.index0 % univ_imgs|length] }}');">
                <span class="card-badge" style="color: var(--accent);">University</span>
            </div>
            <div class="card-body">
                <h4>{{ item.basic_info.name_en or item.basic_info.name_ja }}</h4>
                <p style="color: var(--text-gray); font-size: 0.9rem; margin-bottom: 15px;">Official National/Private Institute</p>
            </div>
            <div class="card-footer">
                <span class="card-price" style="color: var(--accent);">Global Programs</span>
                <span style="font-size: 0.75rem; background: #fff7ed; color: #c2410c; padding: 4px 10px; border-radius: 6px; font-weight: 700;">TOP TIER</span>
            </div>
        </a>
        {% endfor %}
    </div>

    <!-- Essential Guides (복구) -->
    <div class="section-header" style="margin-top: 80px;">
        <h2 class="section-title">Essential Guides</h2>
        <a href="/guide" class="view-all">All guides →</a>
    </div>
    <div class="card-grid">
        {% for guide in latest_guides %}
        <a href="{{ guide.link }}" class="card">
            <div class="card-img" style="background-image: url('{{ guide.thumbnail }}'); height: 180px;"></div>
            <div class="card-body">
                <span style="font-size: 0.75rem; color: var(--primary); font-weight: 800; text-transform: uppercase;">{{ guide.category }}</span>
                <h4 style="margin: 8px 0; font-size: 1.1rem;">{{ guide.title }}</h4>
                <p style="font-size: 0.85rem; color: var(--text-gray); line-height: 1.6;">{{ guide.description | truncate(80) }}</p>
            </div>
        </a>
        {% endfor %}
    </div>
</div>

{% endblock %}
{# --- 메인 콘텐츠 끝 --- #}


{# --- 스크립트 시작 --- #}
{% block scripts %}
<script>
    // 서버 데이터를 JS 변수로 안전하게 전달
    const SCHOOLS_DATA = {{ schools_json | safe }};
</script>

<!-- 지도 관련 스크립트 -->
<script src="/static/js/map.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key={{ maps_api_key }}&callback=initMap&libraries=marker,geometry&v=weekly" async defer></script>
{% endblock %}
{# --- 스크립트 끝 --- #}